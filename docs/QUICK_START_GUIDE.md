# CCMage 快速上手指南 (SOP)

> **Standard Operating Procedure** - 标准操作流程
> 版本：v1.2.0 | 更新日期：2025-11-29

---

## 📋 目录

1. [首次使用](#首次使用)
2. [项目管理基本操作](#项目管理基本操作)
3. [AI 任务管理](#ai-任务管理)
4. [常见问题](#常见问题)

---

## 🚀 首次使用

### Step 1: 安装和启动

```bash
# 1. 克隆项目
git clone https://github.com/ThendCN/ccmage.git
cd ccmage

# 2. 安装依赖
npm run install:all

# 3. 配置项目列表
cp .claude/projects.example.json .claude/projects.json
# 编辑 .claude/projects.json，添加你的项目路径

# 4. 启动服务
npm run dev

# 5. 打开浏览器
# 访问 http://localhost:5173
```

### Step 2: 配置 AI 引擎（可选，推荐）

CCMage 支持**多引擎 AI**，你可以自由选择和切换：
- ✅ **Claude Code** - Anthropic Claude Agent SDK，强大的代码理解和生成
- ✅ **Codex** - OpenAI Codex SDK，专注代码补全和解释
- 🔜 **Gemini** - Google Gemini（即将支持）

**方式一：图形界面配置（推荐）**
1. 点击右上角 ⚙️ **设置** 按钮
2. 填入 API Key：
   - `ANTHROPIC_API_KEY` - 用于 Claude Code
   - `OPENAI_API_KEY` - 用于 Codex
3. 选择默认 AI 引擎
4. 点击"保存配置"

**方式二：手动配置**
```bash
cp .env.example .env
# 编辑 .env 文件，填入以下配置：
# ANTHROPIC_API_KEY=sk-ant-xxx  # Claude Code
# OPENAI_API_KEY=sk-xxx          # Codex
```

**获取 API Key**
- **Claude Code**:
  - 推荐：[虎三小破站](https://api.husanai.com/register?aff=c34V) - 国内访问快
  - 官方：[Anthropic Console](https://console.anthropic.com/)
- **Codex**: [OpenAI Platform](https://platform.openai.com/)

> 💡 **提示**: 可以只配置一个引擎，也可以同时配置多个自由切换！

### Step 3: 添加第一个项目

**编辑 `.claude/projects.json`**
```json
{
  "projects": {
    "my-first-project": {
      "path": "../my-first-project",
      "tech": ["React", "Node.js"],
      "status": "active",
      "port": 3000,
      "description": "我的第一个项目"
    }
  }
}
```

**刷新浏览器** - 项目会自动出现在列表中！

---

## 🎯 项目管理基本操作

### 1. 查看项目状态

**项目卡片显示信息：**
- 🟢 **Git 状态** - 未提交更改数量
- 📦 **依赖状态** - 是否已安装
- 🚀 **运行状态** - 是否正在运行
- ⚡ **端口信息** - 运行端口号

**状态图标说明：**
- ✅ 绿色：正常
- ⚠️ 黄色：警告（有未提交更改）
- ❌ 红色：错误（依赖未安装）

### 2. 快捷操作

**项目卡片上的操作按钮：**
- 🚀 **启动/停止** - 一键启动或停止项目服务
- 📁 **打开目录** - 在 Finder/文件管理器中打开
- 💻 **打开 VSCode** - 在 VSCode 中打开项目

**点击项目卡片：**
- 打开项目详情页，查看完整信息

### 3. 进程管理

**启动项目：**
1. 点击项目卡片上的 🚀 **启动** 按钮
2. 系统自动检测启动命令并执行
3. 在详情页的"日志" tab 查看实时日志

**停止项目：**
1. 点击项目卡片上的 🛑 **停止** 按钮
2. 进程会优雅退出

**查看日志：**
1. 点击项目卡片进入详情页
2. 切换到"日志" tab
3. 实时 SSE 流式日志输出

### 4. 项目分析

**执行分析：**
1. 进入项目详情页
2. 切换到"项目分析" tab
3. 点击"重新分析"按钮
4. 查看分析报告：
   - 智能检测的启动命令
   - 自动识别的端口
   - 配置文件列表
   - 依赖情况

**应用分析结果：**
1. 在分析报告中找到推荐配置
2. 点击"应用"按钮
3. 配置自动更新到 `projects.json`

---

## 🤖 AI 任务管理

### 1. 创建普通任务

**步骤：**
1. 进入项目详情页 → "任务" tab
2. 点击"新建任务"按钮
3. 填写任务信息：
   - **标题**（必填）
   - 描述
   - 优先级（低/中/高/紧急）
   - 类型（任务/Bug/新功能/改进）
   - 预估工时
   - 截止日期
4. 点击"创建"

### 2. 使用 AI 智能拆分任务 ⭐

**步骤：**
1. 点击"新建任务"
2. 填写任务标题和描述（描述越详细，拆分越准确）
3. ✅ 勾选"✨ 使用 AI 智能拆分任务"
4. 点击"AI 智能拆分并创建"
5. 等待 3-5 秒，AI 自动拆分
6. 查看创建的主任务和 3-8 个子任务

**示例任务描述：**
```
标题：实现用户登录功能
描述：
支持邮箱和手机号登录，需要密码加密和会话管理。
包括前端登录表单、后端API接口、数据库设计和单元测试。
```

**AI 自动生成：**
- ✅ 设计数据库表结构 (2h)
- ✅ 实现密码加密服务 (1.5h)
- ✅ 开发登录 API 接口 (3h)
- ✅ 实现会话管理 (2h)
- ✅ 前端登录表单 (2.5h)
- ✅ 编写单元测试 (1.5h)

### 3. 任务层级展示

**查看任务：**
- 📦 **主任务**：以卡片形式展示
- 🔽 **子任务**：点击折叠/展开图标查看
- 📈 **进度条**：显示子任务完成进度（如：3/6 完成 50%）

**操作任务：**
- ✏️ **编辑**：点击蓝色编辑按钮
- 🗑️ **删除**：点击红色删除按钮
- ⭕ **切换状态**：点击状态图标（待处理 → 进行中 → 已完成）

### 4. AI 协作助手 ⭐

**使用方法：**
1. 在任务卡片上点击 🤖 **AI** 按钮
2. AI 对话框自动打开，任务信息预填充
3. **选择 AI 引擎**（Claude Code 或 Codex）
4. 在输入框中提问（任务上下文已自动注入）
5. AI 回答会考虑当前任务的背景

**多引擎切换：** 🔄
- 在 AI 对话框顶部选择引擎
- 可随时在 Claude Code 和 Codex 之间切换
- 对话历史完整保留，不会丢失
- 不同引擎有不同的专长：
  - Claude Code：擅长代码理解和架构设计
  - Codex：擅长代码补全和解释

**示例对话：**
```
[选择引擎：Claude Code]

用户：这个功能应该如何实现？
AI：（已了解任务"实现用户登录功能"的上下文）
根据你的任务描述，我建议...

[切换到 Codex]

用户：帮我写一段密码加密的代码
AI：当然，这是一段使用 bcrypt 的密码加密代码...
```

**快捷状态更新：**
- 🔵 **[开始任务]** - 将状态从"待处理"改为"进行中"
- 🟠 **[暂停]** - 暂停任务，状态返回"待处理"
- 🟢 **[完成]** - 标记为"已完成"
- ⚪ **[重新开启]** - 重新激活已完成的任务

**关闭对话框：**
- 任务列表会自动刷新，显示最新状态

### 5. 编辑任务

**编辑主任务或子任务：**
1. 点击任务右侧的 ✏️ **编辑** 按钮
2. 修改任务信息
3. 点击"更新"保存

**可编辑字段：**
- 标题
- 描述
- 优先级（低/中/高/紧急）
- 类型（任务/Bug/新功能/改进）
- 预估工时
- 截止日期

---

## ❓ 常见问题

### Q1: 项目卡片显示"依赖未安装"怎么办？

**A:**
1. 点击项目卡片进入详情页
2. 点击"安装依赖"按钮
3. 或手动进入项目目录：`cd my-project && npm install`

### Q2: 启动项目时提示"端口已被占用"？

**A:**
1. 检查是否已有相同项目在运行
2. 修改项目配置中的端口号
3. 或杀掉占用端口的进程：`lsof -i :3000` 然后 `kill -9 <PID>`

### Q3: AI 功能无法使用？

**A:**
1. 检查是否配置了至少一个 AI 引擎的 API Key：
   - `ANTHROPIC_API_KEY`（Claude Code）
   - `OPENAI_API_KEY`（Codex）
2. 检查 API Key 是否有效（未过期、有余额）
3. 检查网络连接（国内用户建议使用虎三小破站）
4. 在 AI 对话框中尝试切换不同的引擎
5. 查看浏览器控制台和后端日志排查错误

**提示**：可以先配置一个引擎进行测试，后续再添加其他引擎

### Q4: 项目列表为空？

**A:**
1. 检查 `.claude/projects.json` 是否存在
2. 检查 JSON 格式是否正确
3. 检查项目路径是否正确（相对路径相对于 PROJECT_ROOT）
4. 刷新浏览器

### Q5: AI 拆分任务失败？

**A:**
1. 检查任务描述是否足够详细
2. 检查 AI 功能是否正常（API Key 有效）
3. 查看浏览器控制台错误信息
4. 等待 30 秒超时后重试

### Q6: 如何添加外部项目（绝对路径）？

**A:**
在 `.claude/projects.json` 的 `external` 部分添加：
```json
{
  "external": {
    "my-external-project": {
      "path": "/Users/xxx/Projects/my-project",
      "tech": ["Vue"],
      "status": "production",
      "port": 8080
    }
  }
}
```

### Q7: 如何卸载或停止服务？

**A:**
```bash
# 停止开发服务器
Ctrl+C (或 Cmd+C)

# 完全卸载
cd ccmage
rm -rf node_modules backend/node_modules frontend/node_modules
```

### Q8: 支持哪些项目类型？

**A:**
- ✅ Node.js (React, Vue, Next.js, Express, Nest.js 等)
- ✅ Python (Flask, Django, FastAPI 等)
- ✅ Go, Rust（需手动配置启动命令）
- ✅ 静态网站（HTML/CSS/JS）
- ✅ 自定义项目（手动配置 `startCommand`）

---

## 🎯 最佳实践

### 1. 项目组织

**推荐目录结构：**
```
~/Projects/                    # PROJECT_ROOT
├── project-1/                 # 本地项目（相对路径）
├── project-2/
└── ccmage/                    # 本工具
```

**配置示例：**
```json
{
  "projects": {
    "project-1": {
      "path": "../project-1",  // 相对于 PROJECT_ROOT
      "tech": ["React"],
      "status": "active"
    }
  }
}
```

### 2. 任务管理技巧

**AI 拆分任务时：**
- ✅ 提供详细的任务描述
- ✅ 说明技术栈和约束条件
- ✅ 列出关键需求

**任务标题命名：**
- ✅ 动词开头：实现、修复、优化、重构
- ✅ 简明扼要：≤10 个字
- ✅ 示例：
  - ✅ "实现用户登录功能"
  - ✅ "修复购物车计算错误"
  - ❌ "做个登录"（不够明确）

### 3. AI 协作技巧

**提问时：**
- ✅ 先点击任务的 AI 按钮（自动带入上下文）
- ✅ 问题要具体明确
- ✅ 可以多轮对话，AI 会记住上下文

**示例提问：**
```
❌ "怎么做？"（太模糊）
✅ "实现密码加密应该使用什么算法？"
✅ "登录 API 的请求参数应该如何设计？"
✅ "这个功能需要创建哪些数据库表？"
```

### 4. 进程管理

**建议：**
- ⚠️ 不要同时启动太多项目（占用资源）
- ✅ 关闭不用的项目服务
- ✅ 查看日志排查启动失败原因
- ✅ 使用项目详情页的日志 tab 实时监控

---

## 📞 获取帮助

### 文档资源

- 📖 [完整文档](./README.md) - 详细功能说明
- 📋 [更新日志](./CHANGELOG.md) - 版本更新记录
- 🔧 [架构文档](./docs/ARCHITECTURE.md) - 技术架构
- 🤖 [AI 功能指南](./docs/AI_TODO_USER_GUIDE.md) - AI 功能详解

### 社区支持

- 💬 [提交 Issue](https://github.com/ThendCN/ccmage/issues) - 报告问题或建议
- 📧 Email: support@example.com

---

## 🎉 快速开始检查清单

- [ ] 安装依赖：`npm run install:all`
- [ ] 配置项目列表：`.claude/projects.json`
- [ ] 启动服务：`npm run dev`
- [ ] 打开浏览器：http://localhost:5173
- [ ] （推荐）配置多引擎 AI：
  - [ ] 设置 → ANTHROPIC_API_KEY（Claude Code）
  - [ ] 设置 → OPENAI_API_KEY（Codex）
- [ ] 添加第一个项目到列表
- [ ] 创建第一个任务
- [ ] 尝试 AI 智能拆分任务
- [ ] 使用 AI 协作助手
- [ ] 尝试对话中切换 AI 引擎

---

**祝你使用愉快！🎉**

如有问题，欢迎提 [Issue](https://github.com/ThendCN/ccmage/issues)。
